<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰Ω†ÁöÑÂ§©Ë≥¶ÂÑ™Âã¢Â†±Âëä - Gallup Strengths</title>
    <style>
        :root {
            --primary-blue: #2563eb;
            --secondary-blue: #3b82f6;
            --primary-green: #10b981;
            --gold: #f59e0b;
            --silver: #6b7280;
            --bronze: #92400e;
            --danger: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --surface: #f9fafb;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(180deg, #f0f9ff 0%, #ffffff 100%);
            min-height: 100vh;
        }

        /* Loading State */
        .loading-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-container.active {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Header */
        .header {
            background: var(--bg-gradient);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 16px;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* DNA Visualization */
        .dna-visualization {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
        }

        .dna-title {
            text-align: center;
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 40px;
        }

        .dna-container {
            position: relative;
            height: 600px;
            margin: 0 auto;
            max-width: 800px;
        }

        .dna-helix {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .dna-strand {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .dna-node {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .dna-node:hover {
            transform: scale(1.2);
            z-index: 20;
        }

        .dna-node.dominant {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            box-shadow: 0 8px 16px rgba(245, 158, 11, 0.4);
            width: 80px;
            height: 80px;
            font-size: 16px;
        }

        .dna-node.supporting {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
        }

        .dna-node.lesser {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            box-shadow: 0 4px 8px rgba(107, 114, 128, 0.2);
            width: 40px;
            height: 40px;
            font-size: 12px;
        }

        .dna-connection {
            position: absolute;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(37, 99, 235, 0.2) 50%,
                transparent 100%);
            height: 2px;
            transform-origin: left center;
        }

        .dna-tooltip {
            position: absolute;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow-xl);
            display: none;
            z-index: 30;
            min-width: 250px;
        }

        .dna-tooltip.active {
            display: block;
        }

        .tooltip-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .tooltip-score {
            color: var(--primary-blue);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .tooltip-desc {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        /* Strength Categories */
        .strength-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .category-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .category-icon.dominant {
            background: rgba(245, 158, 11, 0.1);
        }

        .category-icon.supporting {
            background: rgba(37, 99, 235, 0.1);
        }

        .category-icon.lesser {
            background: rgba(107, 114, 128, 0.1);
        }

        .category-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .strength-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .strength-item:last-child {
            border-bottom: none;
        }

        .strength-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .strength-score-bar {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .score-bar {
            width: 100px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .score-fill.dominant {
            background: linear-gradient(90deg, #f59e0b, #f97316);
        }

        .score-fill.supporting {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .score-fill.lesser {
            background: linear-gradient(90deg, #9ca3af, #6b7280);
        }

        .score-value {
            font-weight: 600;
            color: var(--text-primary);
            min-width: 30px;
            text-align: right;
        }

        /* Action Buttons */
        .action-section {
            text-align: center;
            margin-top: 40px;
        }

        .btn {
            display: inline-block;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-blue);
            border: 2px solid var(--primary-blue);
            margin-left: 16px;
        }

        .btn-secondary:hover {
            background: var(--surface);
        }
    </style>
</head>
<body>
    <!-- Loading State -->
    <div class="loading-container active" id="loadingContainer">
        <div class="loading-spinner"></div>
        <p style="margin-top: 20px; color: var(--text-secondary);">Ê≠£Âú®ÁîüÊàêÊÇ®ÁöÑÂ§©Ë≥¶Â†±Âëä...</p>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>üß¨ ‰Ω†ÁöÑÂ§©Ë≥¶DNAÂúñË≠ú</h1>
        <p>Âü∫ÊñºÁßëÂ≠∏Ë©ï‰º∞ÁöÑÂÄã‰∫∫ÂÑ™Âã¢ÂàÜÊûêÂ†±Âëä</p>
    </div>

    <div class="container">
        <!-- DNA Visualization -->
        <div class="dna-visualization">
            <h2 class="dna-title">Â§©Ë≥¶DNAËû∫ÊóãÂúñ</h2>
            <div class="dna-container" id="dnaContainer">
                <div class="dna-helix" id="dnaHelix"></div>
            </div>
            <div class="dna-tooltip" id="dnaTooltip">
                <div class="tooltip-title"></div>
                <div class="tooltip-score"></div>
                <div class="tooltip-desc"></div>
            </div>
        </div>

        <!-- Strength Categories -->
        <div class="strength-categories" id="strengthCategories">
            <!-- Will be populated dynamically -->
        </div>

        <!-- Action Section -->
        <div class="action-section">
            <button class="btn btn-primary" onclick="downloadReport()">
                ‰∏ãËºâÂÆåÊï¥PDFÂ†±Âëä
            </button>
            <button class="btn btn-secondary" onclick="shareResults()">
                ÂàÜ‰∫´ÁµêÊûú
            </button>
        </div>
    </div>

    <script>
        // Sample data structure (will be replaced with API data)
        const strengthData = {
            T1: { name: "ÁµêÊßãÂåñÂü∑Ë°å", score: 75, desc: "ÊìÖÈï∑Â∞áË§áÈõúÁõÆÊ®ôÊãÜËß£ÁÇ∫Ê∏ÖÊô∞ÂèØÂü∑Ë°åÁöÑË®àÁï´" },
            T2: { name: "ÂìÅË≥™ËàáÂÆåÂÇô", score: 82, desc: "Ê≥®ÈáçÁ¥∞ÁØÄ„ÄÅËøΩÊ±ÇÁ≤æÁ¢∫ËàáÂÆåÁæé" },
            T3: { name: "Êé¢Á¥¢ËàáÂâµÊñ∞", score: 91, desc: "ÂÖÖÊªøÂ•ΩÂ•áÂøÉÔºåÊ®ÇÊñºÂòóË©¶Êñ∞ÊñπÊ≥ï" },
            T4: { name: "ÂàÜÊûêËàáÊ¥ûÂØü", score: 88, desc: "Ê∑±ÂÖ•Á†îÁ©∂Êï∏ÊìöÔºåÁôºÁèæÊ†∏ÂøÉÂïèÈ°å" },
            T5: { name: "ÂΩ±ÈüøËàáÂÄ°Ë≠∞", score: 79, desc: "ÂñÑÊñºË™™Êúç‰ªñ‰∫∫ÔºåÊøÄÂãµÂúòÈöäÂâçÈÄ≤" },
            T6: { name: "Âçî‰ΩúËàáÂÖ±Â•Ω", score: 70, desc: "ÁèçË¶ñÂúòÈöäÂêà‰ΩúÔºåÂâµÈÄ†ÂíåË´ßÊ∞õÂúç" },
            T7: { name: "ÂÆ¢Êà∂Â∞éÂêë", score: 65, desc: "ÁêÜËß£‰∏¶ÊªøË∂≥ÂÆ¢Êà∂ÈúÄÊ±Ç" },
            T8: { name: "Â≠∏ÁøíËàáÊàêÈï∑", score: 95, desc: "Â∞çÊñ∞Áü•Ë≠òÂÖÖÊªøÁÜ±ÊÉÖÔºåÊåÅÁ∫åÂ≠∏Áøí" },
            T9: { name: "Á¥ÄÂæãËàá‰ø°‰ªª", score: 72, desc: "ÂÅö‰∫ãÊúâÊ¢ù‰∏çÁ¥äÔºåË¥èÂæó‰ªñ‰∫∫‰ø°Ë≥¥" },
            T10: { name: "Â£ìÂäõË™øÁØÄ", score: 45, desc: "Âú®Â£ìÂäõ‰∏ã‰øùÊåÅÂÜ∑ÈùúÂÆ¢ËßÄ" },
            T11: { name: "Ë°ùÁ™ÅÊï¥Âêà", score: 58, desc: "Â∞ãÊâæÂÖ±Ë≠òËàáÊúÄ‰Ω≥Ëß£Ê±∫ÊñπÊ°à" },
            T12: { name: "Ë≤¨‰ªªËàáÁï∂Ë≤¨", score: 86, desc: "Â∞çÊâøË´æË®ÄÂá∫ÂøÖË°åÔºåË≤†Ëµ∑ÂÖ®Ë≤¨" }
        };

        // Categorize strengths
        function categorizeStrengths(data) {
            const sorted = Object.entries(data)
                .sort((a, b) => b[1].score - a[1].score)
                .map((item, index) => ({
                    id: item[0],
                    ...item[1],
                    rank: index + 1
                }));

            const dominant = sorted.filter(s => s.score >= 75);
            const supporting = sorted.filter(s => s.score >= 25 && s.score < 75);
            const lesser = sorted.filter(s => s.score < 25);

            return { dominant, supporting, lesser };
        }

        // Create DNA Helix Visualization
        function createDNAHelix() {
            const container = document.getElementById('dnaHelix');
            const categorized = categorizeStrengths(strengthData);
            const allStrengths = [
                ...categorized.dominant,
                ...categorized.supporting,
                ...categorized.lesser
            ];

            // Create double helix pattern
            allStrengths.forEach((strength, index) => {
                const angle = (index / allStrengths.length) * Math.PI * 4; // 2 full rotations
                const y = (index / allStrengths.length) * 550;

                // Left strand
                const x1 = 250 + Math.sin(angle) * 150;
                // Right strand
                const x2 = 250 - Math.sin(angle) * 150;

                // Determine category
                let category = 'lesser';
                if (strength.score >= 75) category = 'dominant';
                else if (strength.score >= 25) category = 'supporting';

                // Create nodes
                createNode(container, strength, x1, y, category, 'left');
                if (index % 2 === 0) { // Only create right nodes for every other item
                    const nextStrength = allStrengths[(index + 1) % allStrengths.length];
                    if (nextStrength) {
                        createNode(container, nextStrength, x2, y + 30, category, 'right');

                        // Create connection
                        createConnection(container, x1, y + 30, x2, y + 30);
                    }
                }
            });
        }

        function createNode(container, strength, x, y, category, side) {
            const node = document.createElement('div');
            node.className = `dna-node ${category}`;
            node.style.left = `${x}px`;
            node.style.top = `${y}px`;
            node.textContent = strength.id;

            node.addEventListener('mouseenter', (e) => {
                showTooltip(e, strength);
            });

            node.addEventListener('mouseleave', () => {
                hideTooltip();
            });

            container.appendChild(node);
        }

        function createConnection(container, x1, y1, x2, y2) {
            const connection = document.createElement('div');
            connection.className = 'dna-connection';

            const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const angle = Math.atan2(y2 - y1, x2 - x1);

            connection.style.width = `${length}px`;
            connection.style.left = `${x1}px`;
            connection.style.top = `${y1}px`;
            connection.style.transform = `rotate(${angle}rad)`;

            container.appendChild(connection);
        }

        function showTooltip(event, strength) {
            const tooltip = document.getElementById('dnaTooltip');
            const rect = event.target.getBoundingClientRect();

            tooltip.querySelector('.tooltip-title').textContent = strength.name;
            tooltip.querySelector('.tooltip-score').textContent = strength.score;
            tooltip.querySelector('.tooltip-desc').textContent = strength.desc;

            tooltip.style.left = `${rect.left + rect.width / 2 - 125}px`;
            tooltip.style.top = `${rect.bottom + 10}px`;
            tooltip.classList.add('active');
        }

        function hideTooltip() {
            document.getElementById('dnaTooltip').classList.remove('active');
        }

        // Populate strength categories
        function populateCategories() {
            const container = document.getElementById('strengthCategories');
            const categorized = categorizeStrengths(strengthData);

            // Dominant Strengths
            if (categorized.dominant.length > 0) {
                container.appendChild(createCategoryCard(
                    '‰∏ªÂ∞éÊâçÂππ',
                    'üåü',
                    'dominant',
                    categorized.dominant
                ));
            }

            // Supporting Strengths
            if (categorized.supporting.length > 0) {
                container.appendChild(createCategoryCard(
                    'ËºîÂä©ÊâçÂππ',
                    'üí™',
                    'supporting',
                    categorized.supporting
                ));
            }

            // Lesser Strengths
            if (categorized.lesser.length > 0) {
                container.appendChild(createCategoryCard(
                    'ËºÉÂº±ÊâçÂππ',
                    'üìà',
                    'lesser',
                    categorized.lesser
                ));
            }
        }

        function createCategoryCard(title, icon, category, strengths) {
            const card = document.createElement('div');
            card.className = 'category-card';

            card.innerHTML = `
                <div class="category-header">
                    <div class="category-icon ${category}">${icon}</div>
                    <div class="category-title">${title}</div>
                </div>
                <div class="strength-list">
                    ${strengths.map(s => `
                        <div class="strength-item">
                            <span class="strength-name">${s.name}</span>
                            <div class="strength-score-bar">
                                <div class="score-bar">
                                    <div class="score-fill ${category}" style="width: ${s.score}%"></div>
                                </div>
                                <span class="score-value">${s.score}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            return card;
        }

        // Load results from API
        async function loadResults() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session');

            if (sessionId) {
                try {
                    const response = await fetch(`/api/v1/scoring/results/${sessionId}`);
                    if (response.ok) {
                        const data = await response.json();
                        // Update strengthData with actual API data
                        if (data.strength_scores) {
                            Object.keys(data.strength_scores).forEach(key => {
                                if (strengthData[key]) {
                                    strengthData[key].score = data.strength_scores[key];
                                }
                            });
                        }
                    }
                } catch (error) {
                    console.error('Error loading results:', error);
                }
            }

            // Hide loading and show results
            document.getElementById('loadingContainer').classList.remove('active');

            // Initialize visualizations
            createDNAHelix();
            populateCategories();
        }

        function downloadReport() {
            alert('PDFÂ†±ÂëäÁîüÊàêÂäüËÉΩÈñãÁôº‰∏≠...');
        }

        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'ÊàëÁöÑÂ§©Ë≥¶ÂÑ™Âã¢Â†±Âëä',
                    text: '‰æÜÁúãÁúãÊàëÁöÑGallupÂÑ™Âã¢Ê∏¨Ë©ïÁµêÊûúÔºÅ',
                    url: window.location.href
                });
            } else {
                alert('ÂàÜ‰∫´ÂäüËÉΩÈñãÁôº‰∏≠...');
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadResults, 1000); // Add slight delay for effect
        });
    </script>
</body>
</html>