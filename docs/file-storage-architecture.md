# æ–‡ä»¶å­˜å„²æ¶æ§‹ - å¿«é€Ÿé–‹ç™¼ç‰ˆæœ¬

## æ¦‚è¿°

ç‚ºäº†æ”¯æŒå¿«é€Ÿ Try-and-Error é–‹ç™¼æ¨¡å¼ï¼Œç³»çµ±å·²å®Œå…¨è½‰æ›ç‚ºæ–‡ä»¶å­˜å„²æ¶æ§‹ï¼Œä½¿ç”¨ CSV/JSON æ–‡ä»¶æ›¿ä»£ SQLite æ•¸æ“šåº«ã€‚

## æ¶æ§‹è®Šæ›´ç¸½çµ

### ğŸ”„ **è®Šæ›´å‰å¾Œå°æ¯”**

| å±¤é¢ | æ•¸æ“šåº«ç‰ˆæœ¬ | æ–‡ä»¶å­˜å„²ç‰ˆæœ¬ |
|:-----|:-----------|:-------------|
| **å­˜å„²æ–¹å¼** | SQLite (.db) | CSV + JSON æ–‡ä»¶ |
| **æ•¸æ“šä¿®æ”¹** | éœ€è¦ SQL é·ç§» | ç›´æ¥ç·¨è¼¯æ–‡ä»¶ |
| **å‚™ä»½ç­–ç•¥** | æ•¸æ“šåº«å‚™ä»½ | æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶ |
| **é–‹ç™¼é€Ÿåº¦** | ä¸­ç­‰ | æ¥µå¿« |
| **èª¿è©¦é›£åº¦** | éœ€è¦ SQL å·¥å…· | æ–‡æœ¬ç·¨è¼¯å™¨å³å¯ |
| **éƒ¨ç½²è¤‡é›œåº¦** | ä¸­ç­‰ | æ¥µç°¡ |

### ğŸ“ **æ–°çš„å­˜å„²çµæ§‹**

```
data/file_storage/
â”œâ”€â”€ v4_statements.json         # è©•æ¸¬èªå¥æ•¸æ“š
â”œâ”€â”€ v4_statements.csv          # åŒä¸Šï¼ŒCSV æ ¼å¼
â”œâ”€â”€ v4_sessions.json           # è©•æ¸¬æœƒè©±
â”œâ”€â”€ v4_responses.json          # ç”¨æˆ¶å›æ‡‰
â”œâ”€â”€ v4_response_items.json     # è©³ç´°å›æ‡‰é …ç›®
â”œâ”€â”€ v4_scores.json             # è¨ˆåˆ†çµæœ
â”œâ”€â”€ export_summary.json        # æ•¸æ“šå°å‡ºæ‘˜è¦
â””â”€â”€ backups/                   # è‡ªå‹•å‚™ä»½
    â””â”€â”€ 20251002_140000/
        â”œâ”€â”€ v4_statements.json
        â””â”€â”€ ...
```

## æ ¸å¿ƒçµ„ä»¶

### 1. FileStorageManager

**ä½ç½®**: `src/main/python/core/file_storage.py`

**åŠŸèƒ½**:
- æä¾›é¡ä¼¼æ•¸æ“šåº«çš„ CRUD æ“ä½œ
- è‡ªå‹• JSON/CSV é›™æ ¼å¼å­˜å„²
- å…§å­˜ç·©å­˜æ©Ÿåˆ¶æå‡æ€§èƒ½
- è‡ªå‹•å‚™ä»½èˆ‡ç‰ˆæœ¬æ§åˆ¶

**ä¸»è¦æ–¹æ³•**:
```python
# åŸºæœ¬æ“ä½œ
storage.select_all("table_name")
storage.select_by_id("table_name", "id_field", id_value)
storage.insert("table_name", record_dict)
storage.update("table_name", "id_field", id_value, updates_dict)

# æŸ¥è©¢æ“ä½œ
storage.select_where("table_name", field1="value1", field2="value2")
storage.count("table_name", **conditions)

# ç³»çµ±æ“ä½œ
storage.health_check()
storage.backup_table("table_name")
```

### 2. ç°¡åŒ–çš„ API å±¤

**ä½ç½®**: `src/main/python/api/main_files.py`

**æ–°ç‰¹æ€§**:
- å°ˆç”¨æ–¼æ–‡ä»¶å­˜å„²çš„è·¯ç”±
- ç°¡åŒ–çš„éŒ¯èª¤è™•ç†
- å¿«é€Ÿé‡å•Ÿå’Œæ¸¬è©¦æ”¯æŒ

**ç«¯é»**:
- **ç«¯å£**: 8005 (é¿å…èˆ‡æ•¸æ“šåº«ç‰ˆæœ¬è¡çª)
- **å¥åº·æª¢æŸ¥**: `/api/system/health`
- **è©•æ¸¬å¡Š**: `/api/assessment/blocks`
- **æäº¤è©•æ¸¬**: `/api/assessment/submit`
- **ç²å–çµæœ**: `/api/assessment/results/{session_id}`

### 3. æ¨¡å¡ŠåŒ–çµ„ä»¶

#### è¨ˆåˆ†å¼•æ“ (`core/scoring/`)
- `quality_checker.py`: ç°¡åŒ–ç‰ˆæœ¬è³ªé‡æª¢æŸ¥
- `v4_scoring_engine.py`: åŸºæ–¼æ–‡ä»¶çš„è¨ˆåˆ†é‚è¼¯

#### é¡Œçµ„ç”Ÿæˆ (`core/thurstonian/`)
- `block_generator.py`: å¹³è¡¡é¡Œçµ„ç”Ÿæˆç®—æ³•

## ä½¿ç”¨æŒ‡å—

### ğŸš€ **å•Ÿå‹•ç³»çµ±**

```bash
# åœæ­¢åŸæ•¸æ“šåº«ç‰ˆæœ¬ (ç«¯å£ 8004)
# å•Ÿå‹•æ–‡ä»¶å­˜å„²ç‰ˆæœ¬ (ç«¯å£ 8005)
cd src/main/python
python3 -m uvicorn api.main_files:app --host 0.0.0.0 --port 8005 --reload
```

### ğŸ“Š **è¨ªå•ç«¯é»**

```bash
# ç³»çµ±å¥åº·æª¢æŸ¥
curl http://localhost:8005/api/system/health

# ç²å–è©•æ¸¬é¡Œçµ„
curl http://localhost:8005/api/assessment/blocks

# å‰ç«¯é é¢
http://localhost:8005/landing.html
http://localhost:8005/assessment.html
http://localhost:8005/results.html
```

### ğŸ› ï¸ **å¿«é€Ÿæ•¸æ“šä¿®æ”¹**

#### ä¿®æ”¹è©•æ¸¬èªå¥
```bash
# ç›´æ¥ç·¨è¼¯ JSON æ–‡ä»¶
vim data/file_storage/v4_statements.json

# æˆ–ç·¨è¼¯ CSV æ–‡ä»¶
vim data/file_storage/v4_statements.csv

# ç³»çµ±æœƒè‡ªå‹•é‡æ–°åŠ è¼‰
```

#### æŸ¥çœ‹ç³»çµ±ç‹€æ…‹
```python
# Python æª¢æŸ¥
from core.file_storage import get_file_storage
storage = get_file_storage()
print(storage.health_check())
```

### ğŸ”„ **Try-and-Error å·¥ä½œæµç¨‹**

1. **ä¿®æ”¹æ•¸æ“š**:
   ```bash
   # ç·¨è¼¯èªå¥æ–‡ä»¶
   vim data/file_storage/v4_statements.json
   ```

2. **æ¸¬è©¦è®Šæ›´**:
   ```bash
   # ç²å–æ–°çš„è©•æ¸¬å¡Šæ¸¬è©¦
   curl http://localhost:8005/api/assessment/blocks
   ```

3. **ç‰ˆæœ¬æ§åˆ¶**:
   ```bash
   # æäº¤è®Šæ›´
   git add data/file_storage/
   git commit -m "test: ä¿®æ”¹èªå¥é…ç½®é€²è¡Œæ¸¬è©¦"
   ```

4. **å¿«é€Ÿå›æ»¾**:
   ```bash
   # å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œå¿«é€Ÿå›æ»¾
   git checkout -- data/file_storage/
   ```

## å„ªå‹¢

### âœ… **é–‹ç™¼æ•ˆç‡**
- **å³æ™‚ä¿®æ”¹**: ç·¨è¼¯æ–‡ä»¶å¾Œç«‹å³ç”Ÿæ•ˆ
- **å¯è¦–åŒ–**: JSON/CSV æ ¼å¼äººé¡å¯è®€
- **ç‰ˆæœ¬æ§åˆ¶**: Git å‹å¥½çš„æ–‡æœ¬æ ¼å¼
- **å¿«é€Ÿå‚™ä»½**: ç°¡å–®çš„æ–‡ä»¶å¾©åˆ¶

### âœ… **æ¸¬è©¦å‹å¥½**
- **æ•¸æ“šéš”é›¢**: æ¯å€‹æ¸¬è©¦å¯ä½¿ç”¨ç¨ç«‹æ•¸æ“šé›†
- **å¿«é€Ÿé‡ç½®**: åˆ é™¤æ–‡ä»¶å³é‡ç½®ç‹€æ…‹
- **èª¿è©¦ç°¡å–®**: ç›´æ¥æŸ¥çœ‹ JSON æ•¸æ“š

### âœ… **éƒ¨ç½²ç°¡ä¾¿**
- **ç„¡ä¾è³´**: ä¸éœ€è¦æ•¸æ“šåº«æœå‹™
- **è·¨å¹³å°**: ç´”æ–‡ä»¶å­˜å„²
- **é›¶é…ç½®**: é–‹ç®±å³ç”¨

## é™åˆ¶èˆ‡æ³¨æ„äº‹é …

### âš ï¸ **æ€§èƒ½é™åˆ¶**
- ä¸é©åˆå¤§é‡ä¸¦ç™¼ç”¨æˆ¶
- å…§å­˜ä½¿ç”¨éš¨æ•¸æ“šé‡å¢é•·
- æ–‡ä»¶ I/O å¯èƒ½æˆç‚ºç“¶é ¸

### âš ï¸ **æ•¸æ“šä¸€è‡´æ€§**
- ç„¡äº‹å‹™æ”¯æŒ
- ä¸¦ç™¼å¯«å…¥å¯èƒ½å°è‡´æ•¸æ“šä¸Ÿå¤±
- éœ€è¦æ‡‰ç”¨å±¤é–æ©Ÿåˆ¶

### âš ï¸ **é©ç”¨å ´æ™¯**
- âœ… åŸå‹é–‹ç™¼
- âœ… ç®—æ³•æ¸¬è©¦
- âœ… å°è¦æ¨¡æ¼”ç¤º
- âŒ ç”Ÿç”¢ç’°å¢ƒ
- âŒ é«˜ä¸¦ç™¼å ´æ™¯

## é·ç§»æŒ‡å—

### å¾æ•¸æ“šåº«ç‰ˆæœ¬é·ç§»åˆ°æ–‡ä»¶å­˜å„²

1. **æ•¸æ“šå°å‡º**:
   ```bash
   python3 scripts/export_db_to_files.py
   ```

2. **åˆ‡æ›æœå‹™**:
   ```bash
   # åœæ­¢æ•¸æ“šåº«ç‰ˆæœ¬
   # å•Ÿå‹•æ–‡ä»¶å­˜å„²ç‰ˆæœ¬
   python3 -m uvicorn api.main_files:app --port 8005
   ```

### å¾æ–‡ä»¶å­˜å„²å›åˆ°æ•¸æ“šåº«

1. **æ•¸æ“šå°å…¥** (å¾…é–‹ç™¼):
   ```bash
   python3 scripts/import_files_to_db.py
   ```

2. **åˆ‡æ›æœå‹™**:
   ```bash
   # åœæ­¢æ–‡ä»¶å­˜å„²ç‰ˆæœ¬
   # å•Ÿå‹•æ•¸æ“šåº«ç‰ˆæœ¬
   python3 -m uvicorn api.main:app --port 8004
   ```

## æ¸¬è©¦é©—è­‰

### åŠŸèƒ½æ¸¬è©¦
- âœ… è©•æ¸¬å¡Šç”Ÿæˆ
- âœ… ç”¨æˆ¶éŸ¿æ‡‰å­˜å„²
- âœ… è¨ˆåˆ†ç®—æ³•é‹è¡Œ
- âœ… çµæœé é¢é¡¯ç¤º
- âœ… å°èˆªæµç¨‹å®Œæ•´

### æ€§èƒ½æ¸¬è©¦
- âœ… å–®ç”¨æˆ¶æµç¨‹ < 5ç§’
- âœ… æ•¸æ“šè®€å– < 100ms
- âœ… æ–‡ä»¶å­˜å„² < 50ms

---

## å¿«é€Ÿä¸Šæ‰‹

1. **å…‹éš†é …ç›®** (å¦‚æœéœ€è¦)
2. **åˆ‡æ›åˆ°æ–‡ä»¶å­˜å„²åˆ†æ”¯**:
   ```bash
   git checkout feature/file-storage
   ```
3. **å•Ÿå‹•æœå‹™**:
   ```bash
   cd src/main/python
   python3 -m uvicorn api.main_files:app --port 8005 --reload
   ```
4. **é–‹å§‹æ¸¬è©¦**:
   ```bash
   open http://localhost:8005/landing.html
   ```

**äº«å—å¿«é€Ÿ Try-and-Error é–‹ç™¼é«”é©—ï¼** ğŸš€